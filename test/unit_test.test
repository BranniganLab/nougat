package require tcltest
namespace import ::tcltest::*

configure -verbose pbt
# Software under test

source ../utilities/helper_procs.tcl
load ../utilities/vecexpr.so

 test tailtiltA {
    Test: calculateTiltAngles
} -setup {
   mol new ../testing_materials/lipid_membrane/singlelipid.gro
   set seltext [format {name "C.*" "D.*" and name ".*A"}]
   set sel1 [atomselect top "$seltext"]
} -body {
    return [calculateTiltAngles 4 [$sel1 get x] [$sel1 get y] [$sel1 get z]]
} -result {{-0.024989655264393507 -0.008996903827067389 -0.9996472242002643} {-0.024989655264393507 -0.008996903827067389 -0.9996472242002643} {-0.024989655264393507 -0.008996903827067389 -0.9996472242002643} {-0.024989655264393507 -0.008996903827067389 -0.9996472242002643}} -cleanup {
   mol delete top
}

test tailtiltB {
    Test: calculateTiltAngles
} -setup {
   mol new ../testing_materials/lipid_membrane/singlelipid.gro
   set seltext [format {name "C.*" and name ".*B"}]
   set sel1 [atomselect top "$seltext"]
} -body {
    return [calculateTiltAngles 4 [$sel1 get x] [$sel1 get y] [$sel1 get z]]
} -result {{0.01699727942753822 -0.008331713045145085 -0.9998208214724253} {0.01699727942753822 -0.008331713045145085 -0.9998208214724253} {0.01699727942753822 -0.008331713045145085 -0.9998208214724253} {0.01699727942753822 -0.008331713045145085 -0.9998208214724253}} -cleanup {
   mol delete top
}

test tailtilt90 {
    Test: calculateTiltAngles
} -setup {
   mol new ../testing_materials/lipid_membrane/90degreelipid.gro
   set seltext [format {name "C.*" and name ".*B"}]
   set sel1 [atomselect top "$seltext"]
} -body {
    return [calculateTiltAngles 4 [$sel1 get x] [$sel1 get y] [$sel1 get z]]
} -result {{0.016996254027375264 -0.9998208399974864 0.008331581828062434} {0.016996254027375264 -0.9998208399974864 0.008331581828062434} {0.016996254027375264 -0.9998208399974864 0.008331581828062434} {0.016996254027375264 -0.9998208399974864 0.008331581828062434}} -cleanup {
   mol delete top
}

test tailtilt30 {
    Test: calculateTiltAngles
} -setup {
   mol new ../testing_materials/lipid_membrane/30degreelipid.gro
   set seltext [format {name "C.*" and name ".*B"}]
   set sel1 [atomselect top "$seltext"]
} -body {
    return [calculateTiltAngles 4 [$sel1 get x] [$sel1 get y] [$sel1 get z]]
} -result {{0.01700683127071718 -0.5071939901785861 -0.8616641016178251} {0.01700683127071718 -0.5071939901785861 -0.8616641016178251} {0.01700683127071718 -0.5071939901785861 -0.8616641016178251} {0.01700683127071718 -0.5071939901785861 -0.8616641016178251}} -cleanup {
   mol delete top
}

test tailtilt180 {
    Test: calculateTiltAngles
} -setup {
   mol new ../testing_materials/lipid_membrane/180degreelipid.gro
   set seltext [format {name "C.*" and name ".*B"}]
   set sel1 [atomselect top "$seltext"]
} -body {
    return [calculateTiltAngles 4 [$sel1 get x] [$sel1 get y] [$sel1 get z]]
} -result {{0.016997296684880182 0.008331912205216686 0.999820819519383} {0.016997296684880182 0.008331912205216686 0.999820819519383} {0.016997296684880182 0.008331912205216686 0.999820819519383} {0.016997296684880182 0.008331912205216686 0.999820819519383}} -cleanup {
   mol delete top
}

test fittailszshift {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/singlechain.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get z] 1]
} -result -6.0 -cleanup {
   mol delete top
}

test fittailssinglepoint {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/singlechainstacked.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get z] 1]
} -result 0.0 -cleanup {
   mol delete top
}

test fittailsdoublelength {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/singlechaindoublelength.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get z] 1]
} -result -12.0 -cleanup {
   mol delete top
}

test fittailscheckx {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/singlechain.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get x] 1]
} -result 0.0 -cleanup {
   mol delete top
}

test fittailschecky {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/singlechain.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get y] 1]
} -result 0.0 -cleanup {
   mol delete top
}

test fittailssquarez {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/squarechain.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get z] 1]
} -result 20.0 -cleanup {
   mol delete top
}

test fittailssquarex {
    Test: fitTailVectors
} -setup {
   mol new ../testing_materials/Single_chain/squarechain.gro
   set sel1 [atomselect top "all"]
} -body {
    return [fitTailVectors 4 [$sel1 get x] 1]
} -result 0.0 -cleanup {
   mol delete top
}

test joinvcatlist {
    Test: concatenateList
} -setup {
   set data {1 2 3 4 5}
   set test [join $data " , "] 
    set test2 [concatenateList $data ,]
    if {$test == $test2} {
    set l 0
    } else {
    set l 1
    }
} -body {
    return $l
} -result 0 -cleanup {}

test catlistorfunc {
    Test: concatenateList
} -setup {
   set data {1 2 3 4 5}
} -body {
    return [concatenateList $data "or"]
} -result "(1) or (2) or (3) or (4) or (5)" -cleanup {}
